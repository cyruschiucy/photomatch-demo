<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Display</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .aspect-9-16 {
            aspect-ratio: 9 / 16;
        }
        .timer-circle {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            width: 33%;
            aspect-ratio: 1/1;
            font-size: 2rem;
        }
        .desc-middle {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            text-align: center;
            padding: 0.5rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        .desc-bottom {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            text-align: center;
            padding: 0.5rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        .notification {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ef4444;
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            z-index: 50;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .pull-to-refresh {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 40;
            display: none;
        }
        @media (max-width: 640px) {
            .timer-circle {
                font-size: 1.5rem;
            }
            .desc-middle, .desc-bottom {
                font-size: 0.75rem;
            }
            .pull-to-refresh {
                font-size: 0.75rem;
                padding: 0.4rem 0.8rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-6 flex-1">
        <!-- Display Mode Selection -->
        <div class="mb-6 text-center space-y-4">
            <div>
                <label for="displayMode" class="text-lg font-medium mr-2">Select Display Mode:</label>
                <select id="displayMode" class="p-2 border rounded-lg" aria-label="Choose display mode">
                    <option value="four">4 Photos</option>
                    <option value="one">1 Photo</option>
                </select>
            </div>
            <div>
                <label for="descPosition" class="text-lg font-medium mr-2">Description Position:</label>
                <select id="descPosition" class="p-2 border rounded-lg" aria-label="Choose description position">
                    <option value="middle">Middle</option>
                    <option value="bottom">Bottom</option>
                </select>
            </div>
        </div>

        <!-- Refresh Button for 4 Photos Mode -->
        <div id="refreshButtonContainer" class="mb-4 flex justify-center hidden">
            <button id="refreshButton" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600" aria-label="Refresh all photos">Refresh</button>
        </div>

        <!-- Photo Display Area -->
        <div id="photoContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- Photos will be dynamically inserted here -->
        </div>

        <!-- Navigation Button for 1 Photo Mode -->
        <div id="navButtons" class="mt-4 flex justify-center hidden">
            <button id="skipButton" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600" aria-label="Skip to next photo">Skip</button>
        </div>

        <!-- Pull to Refresh Indicator -->
        <div id="pullToRefresh" class="pull-to-refresh">Pull to refresh</div>
    </div>

    <script>
        const images = [
            {
                src: 'https://i.imgur.com/GA4R6XL.jpeg',
                desc: 'Snow-capped mountains under a clear blue sky, ideal for a serene hiking adventure.'
            },
            {
                src: 'https://i.imgur.com/1VM7424.jpeg',
                desc: 'Golden autumn leaves fall in a vibrant forest, creating a peaceful and picturesque scene.'
            },
            {
                src: 'https://i.imgur.com/caXLoP1.jpeg',
                desc: 'Gentle ocean waves touch a sandy beach, with a sunset sky and soaring seagulls.'
            },
            {
                src: 'https://i.imgur.com/vnotmmp.jpeg',
                desc: 'Lush green valley with a winding river, framed by rolling hills and clouds.'
            },
            {
                src: 'https://i.imgur.com/XagFamV.jpeg',
                desc: 'Majestic waterfall flows down a rocky cliff, surrounded by misty, lush greenery.'
            },
            {
                src: 'https://i.imgur.com/eeTq6gc.png',
                desc: 'Starry desert night with cacti silhouetted against a glowing horizon, evoking tranquility.'
            },
            {
                src: 'https://i.imgur.com/OH2NhWP.png',
                desc: 'Colorful hot air balloons drift over a serene countryside with fields and villages.'
            },
            {
                src: 'https://i.imgur.com/qpa4IMk.jpeg',
                desc: 'Cozy alpine village in a snowy valley, glowing warmly under a twilight sky.'
            }
        ];

        const displayModeSelect = document.getElementById('displayMode');
        const descPositionSelect = document.getElementById('descPosition');
        const photoContainer = document.getElementById('photoContainer');
        const navButtons = document.getElementById('navButtons');
        const skipButton = document.getElementById('skipButton');
        const refreshButtonContainer = document.getElementById('refreshButtonContainer');
        const refreshButton = document.getElementById('refreshButton');
        const pullToRefresh = document.getElementById('pullToRefresh');
        let currentImageIndex = 0;
        let timers = new Map();
        let scrollTimeout = null;
        let lastScrollY = window.scrollY;
        let bottomReached = false;

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            notification.setAttribute('role', 'alert');
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 2000);
        }

        function getRandomItems(array, n) {
            const shuffled = [...array].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, Math.min(n, array.length));
        }

        function createPhotoElement(image, index) {
            const div = document.createElement('div');
            div.className = 'aspect-9-16 w-full overflow-hidden rounded-lg relative';
            div.dataset.id = btoa(image.src).slice(0, 10);
            const img = document.createElement('img');
            img.src = image.src;
            img.alt = image.desc;
            img.className = 'w-full h-full object-cover cursor-pointer';
            img.setAttribute('aria-label', 'Click to start countdown timer for photo');
            img.onerror = () => {
                img.src = 'https://via.placeholder.com/900x1600?text=Image+Failed+to+Load';
                img.alt = 'Failed to load image';
            };
            const descDiv = document.createElement('div');
            descDiv.className = descPositionSelect.value === 'middle' ? 'desc-middle' : 'desc-bottom';
            descDiv.textContent = image.desc;
            const timerDiv = document.createElement('div');
            timerDiv.className = 'timer-circle absolute top-1/3 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-70 text-white hidden';
            timerDiv.id = `timer-${div.dataset.id}`;
            timerDiv.setAttribute('aria-live', 'polite');
            div.appendChild(img);
            div.appendChild(descDiv);
            div.appendChild(timerDiv);
            return div;
        }

        function startCountdown(photoDiv, mode) {
            const id = photoDiv.dataset.id;
            if (timers.size > 0) {
                showNotification('Please wait for the current countdown to finish!');
                return;
            }

            const timerDiv = photoDiv.querySelector(`#timer-${id}`);
            let timeLeft = 15;
            timerDiv.textContent = timeLeft;
            timerDiv.classList.remove('hidden');

            const timer = setInterval(() => {
                timeLeft--;
                timerDiv.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timers.delete(id);
                    timerDiv.classList.add('hidden');
                    replacePhoto(photoDiv, mode);
                }
            }, 1000);

            timers.set(id, timer);
        }

        function replacePhoto(photoDiv, mode) {
            const availableImages = images.filter(img => img.src !== photoDiv.querySelector('img').src);
            const newImage = getRandomItems(availableImages, 1)[0];
            const img = photoDiv.querySelector('img');
            const descDiv = photoDiv.querySelector('.desc-middle, .desc-bottom');
            img.src = newImage.src;
            img.alt = newImage.desc;
            descDiv.textContent = newImage.desc;
            descDiv.className = descPositionSelect.value === 'middle' ? 'desc-middle' : 'desc-bottom';
            if (mode === 'one') {
                currentImageIndex = images.findIndex(img => img.src === newImage.src);
            }
        }

        function updateDisplay() {
            const mode = displayModeSelect.value;
            let activePhotoDiv = null;
            let activeId = null;

            if (mode === 'four' && timers.size > 0) {
                activeId = [...timers.keys()][0];
                activePhotoDiv = photoContainer.querySelector(`[data-id="${activeId}"]`);
            } else {
                timers.forEach(timer => clearInterval(timer));
                timers.clear();
            }

            if (mode === 'four') {
                photoContainer.classList.remove('grid-cols-1');
                photoContainer.classList.add('grid-cols-2', 'sm:grid-cols-2', 'lg:grid-cols-4');
                navButtons.classList.add('hidden');
                refreshButtonContainer.classList.remove('hidden');

                const usedSrcs = activePhotoDiv ? [activePhotoDiv.querySelector('img').src] : [];
                const availableImages = images.filter(img => !usedSrcs.includes(img.src));
                const numPhotosToAdd = activePhotoDiv ? 3 : 4;
                const randomImages = getRandomItems(availableImages, numPhotosToAdd);
                const tempContainer = document.createElement('div');

                for (let i = 0; i < 4; i++) {
                    if (activePhotoDiv && i === 0) {
                        tempContainer.appendChild(activePhotoDiv);
                        continue;
                    }
                    const image = randomImages[i - (activePhotoDiv ? 1 : 0)];
                    const photoDiv = createPhotoElement(image, i);
                    photoDiv.querySelector('img').addEventListener('click', () => startCountdown(photoDiv, 'four'));
                    tempContainer.appendChild(photoDiv);
                }
                photoContainer.innerHTML = '';
                photoContainer.append(...tempContainer.children);
            } else {
                photoContainer.classList.remove('grid-cols-2', 'sm:grid-cols-2', 'lg:grid-cols-4');
                photoContainer.classList.add('grid-cols-1');
                navButtons.classList.remove('hidden');
                refreshButtonContainer.classList.add('hidden');
                const div = createPhotoElement(images[currentImageIndex], 0);
                div.querySelector('img').addEventListener('click', () => startCountdown(div, 'one'));
                photoContainer.appendChild(div);
            }
        }

        window.addEventListener('scroll', () => {
            if (displayModeSelect.value !== 'four' || timers.size > 0) {
                pullToRefresh.style.display = 'none';
                return;
            }

            const currentScrollY = window.scrollY;
            const isScrollingUp = currentScrollY < lastScrollY;
            const isBottomVisible = window.innerHeight + currentScrollY >= document.documentElement.offsetHeight;

            if (isBottomVisible) {
                bottomReached = true;
            } else if (!isScrollingUp) {
                bottomReached = false;
                pullToRefresh.style.display = 'none';
            }

            if (bottomReached && isScrollingUp) {
                pullToRefresh.style.display = 'block';
                if (scrollTimeout) clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    updateDisplay();
                    bottomReached = false;
                    pullToRefresh.style.display = 'none';
                }, 250);
            }

            lastScrollY = currentScrollY;
        });

        skipButton.addEventListener('click', () => {
            const availableIndices = images
                .map((_, i) => i)
                .filter(i => i !== currentImageIndex);
            currentImageIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
            updateDisplay();
        });

        refreshButton.addEventListener('click', () => {
            updateDisplay();
        });

        displayModeSelect.addEventListener('change', () => {
            currentImageIndex = Math.floor(Math.random() * images.length);
            pullToRefresh.style.display = 'none';
            updateDisplay();
        });

        descPositionSelect.addEventListener('change', () => {
            updateDisplay();
        });

        updateDisplay();
    </script>
</body>
</html>
